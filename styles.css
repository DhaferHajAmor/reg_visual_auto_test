:root{
  --bg:#0f1222; --panel:#191c2f; --text:#f2f4ff; --muted:#a7acc6; --accent:#7aa2ff; --danger:#ff3b6b;
  --border:#2a2f4a;
  --btn-bg:#2a335a; --btn-border:#3a4474; --btn-fg:var(--text);
  --btn-bg-secondary:#222741; --btn-border-secondary:#2a2f4a; --btn-fg-secondary:var(--text);
  --help-bg:#2a335a; --help-border:#3a4474;
  --hero-grad:linear-gradient(180deg,rgba(122,162,255,.12),rgba(122,162,255,0));
}
/* Light theme overrides */
[data-theme="light"]{
  --bg:#f7f8fb; --panel:#ffffff; --text:#0b0e1a; --muted:#5a607a; --accent:#355bd6; --danger:#c2185b;
  --border:#e2e5ee;
  --btn-bg:#355bd6; --btn-border:#2e4ec0; --btn-fg:#ffffff;
  --btn-bg-secondary:#eef1fd; --btn-border-secondary:#d9e0fb; --btn-fg-secondary:#182046;
  --help-bg:#eef1fd; --help-border:#d9e0fb;
  --hero-grad:linear-gradient(180deg,rgba(53,91,214,.12),rgba(53,91,214,0));
}
/* Desjardins-like theme */
[data-theme="desjardins"]{
  --bg:#f6f8f7; --panel:#ffffff; --text:#0f231a; --muted:#55655d; --accent:#00873e; --danger:#c2185b;
  --border:#d9e3df;
  --btn-bg:#00873e; --btn-border:#007235; --btn-fg:#ffffff;
  --btn-bg-secondary:#e8f3ee; --btn-border-secondary:#cfe7da; --btn-fg-secondary:#0f231a;
  --help-bg:#e8f3ee; --help-border:#cfe7da;
  --hero-grad:linear-gradient(180deg,rgba(0,135,62,.10),rgba(0,135,62,0));
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
.sr-only{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.container{max-width:960px;margin:0 auto;padding:24px}
.small{font-size:.9rem;color:var(--muted)}
.subtitle{color:var(--muted);margin-top:-12px}

.hero{background:var(--hero-grad);border:1px solid var(--border);border-radius:16px;padding:16px;margin:12px 0}
.cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{background:var(--btn-bg);border:1px solid var(--btn-border);color:var(--btn-fg);padding:10px 14px;border-radius:10px;cursor:pointer}
.btn.secondary{background:var(--btn-bg-secondary);border-color:var(--btn-border-secondary);color:var(--btn-fg-secondary)}
.btn:active{transform:translateY(1px)}
.btn:focus{outline:2px solid var(--accent); outline-offset:2px}
.tab:focus{outline:2px solid var(--accent); outline-offset:2px}
.visdiff-btn:focus{outline:2px solid var(--accent); outline-offset:2px}
.btn[disabled]{opacity:.6;cursor:not-allowed;transform:none}
.btn.blocked{opacity:.55;cursor:not-allowed;position:relative}
.btn.blocked::after{content:'';position:absolute;inset:0;border-radius:inherit;background:repeating-linear-gradient(45deg,rgba(0,0,0,.12)_0,rgba(0,0,0,.12)_6px,transparent_6px,transparent_12px);pointer-events:none}

/* Spinner on Run button when disabled */
#runDiff{position:relative}
#runDiff[disabled]::after{
  content:""; position:absolute; right:10px; top:50%; width:14px; height:14px; margin-top:-7px;
  border:2px solid rgba(255,255,255,.35); border-top-color: var(--accent); border-radius:50%;
  animation: spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

.tabs{display:flex;gap:8px;margin:16px 0}
.tab{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer}
.tab.active{outline:2px solid var(--accent)}
.tabpanel{display:none;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px}
.tabpanel.active{display:block}

ol{padding-left:20px}
a{color:var(--accent)}
.tip{margin-top:12px;color:var(--muted)}

.dropzones{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.dropzone{border:2px dashed var(--border);border-radius:12px;padding:12px;min-height:200px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.dropzone.drag{background:rgba(122,162,255,.06);border-color:var(--accent)}
.dropzone img{max-width:100%;max-height:240px;margin-top:8px;border-radius:8px}
.controls-row{display:flex;gap:12px;align-items:center;margin:8px 0 8px;flex-wrap:wrap}
.canvas{width:100%;border-radius:12px;background:#0b0e1a;border:1px solid var(--border)}
.help{display:inline-block;width:16px;height:16px;line-height:16px;text-align:center;border-radius:50%;background:var(--help-bg);border:1px solid var(--help-border);color:var(--text);font-size:11px;cursor:help}
.diff-wrap{position:relative}
.mask-canvas{position:absolute;inset:0;width:100%;height:100%;border-radius:12px;pointer-events:auto;cursor:default}
.mask-canvas.drawing{cursor:crosshair}
.mask-canvas.moving{cursor:move}

/* Overlay UI injected via bookmarklet */
.visdiff-overlay-root{position:fixed;inset:0;pointer-events:none;z-index:2147483647}
.visdiff-panel{position:fixed;top:16px;right:16px;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px;min-width:260px;pointer-events:auto;box-shadow:0 6px 24px rgba(0,0,0,.35)}
.visdiff-panel h3{margin:0 0 8px 0;font-size:16px}
.visdiff-row{display:flex;gap:8px;align-items:center;margin:6px 0}
.visdiff-row label{font-size:12px;color:var(--muted)}
.visdiff-row input[type="range"]{width:120px}
.visdiff-buttons{display:flex;gap:8px;flex-wrap:wrap}
.visdiff-btn{background:var(--btn-bg-secondary);border:1px solid var(--btn-border-secondary);color:var(--btn-fg-secondary);padding:6px 10px;border-radius:8px;cursor:pointer}
.visdiff-btn.danger{border-color:#4a2030;background:#2b0f1a;color:#ffc8d7}
.visdiff-floating{position:absolute;left:0;top:0;transform-origin:top left;pointer-events:auto;cursor:move}
.visdiff-floating img{display:block;max-width:none}
.visdiff-hidden{display:none !important}

@media (max-width:720px){
  .dropzones{grid-template-columns:1fr}
}