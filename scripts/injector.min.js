(()=>{if(window.__VIS_DIFF__&&window.__VIS_DIFF__.open){window.__VIS_DIFF__.open();return}const d=document;const st=d.createElement('style');st.textContent=`.visdiff-overlay-root{position:fixed;inset:0;pointer-events:none;z-index:2147483647}
.visdiff-panel{position:fixed;top:16px;right:16px;background:#191c2f;color:#f2f4ff;border:1px solid #2a2f4a;border-radius:10px;padding:10px;min-width:260px;pointer-events:auto;box-shadow:0 6px 24px rgba(0,0,0,.35);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
.visdiff-panel h3{margin:0 0 8px 0;font-size:16px}
.visdiff-row{display:flex;gap:8px;align-items:center;margin:6px 0}
.visdiff-row label{font-size:12px;color:#a7acc6}
.visdiff-row input[type=range]{width:120px}
.visdiff-buttons{display:flex;gap:8px;flex-wrap:wrap}
.visdiff-btn{background:#222741;border:1px solid #2a2f4a;color:#f2f4ff;padding:6px 10px;border-radius:8px;cursor:pointer}
.visdiff-btn.danger{border-color:#4a2030;background:#2b0f1a;color:#ffc8d7}
.visdiff-floating{position:absolute;left:0;top:0;transform-origin:top left;pointer-events:auto;cursor:move}
.visdiff-floating img{display:block;max-width:none}
.visdiff-hidden{display:none !important}`;d.documentElement.appendChild(st);const root=d.createElement('div');root.className='visdiff-overlay-root visdiff-hidden';const float=d.createElement('div');float.className='visdiff-floating';const img=d.createElement('img');img.alt='Overlay';float.appendChild(img);root.appendChild(float);const panel=d.createElement('div');panel.className='visdiff-panel visdiff-hidden';panel.innerHTML=`<h3>Visual Overlay</h3>
<div class="visdiff-row"><input type="file" accept="image/*" id="vdupload"></div>
<div class="visdiff-row"><label>Opacity</label><input type="range" id="vdopacity" min="0" max="100" value="60"><span id="vdopval">60%</span></div>
<div class="visdiff-row"><label>Scale</label><input type="range" id="vdscale" min="10" max="400" value="100"><span id="vdscval">100%</span></div>
<div class="visdiff-row"><label>X</label><input type="number" id="vdx" value="0" style="width:80px"><label>Y</label><input type="number" id="vdy" value="0" style="width:80px"></div>
<div class="visdiff-row"><label>Blend</label><select id="vdblend"><option value="normal">normal</option><option value="multiply">multiply</option><option value="screen">screen</option><option value="overlay">overlay</option><option value="darken">darken</option><option value="lighten">lighten</option><option value="difference">difference</option><option value="color-dodge">color-dodge</option><option value="color-burn">color-burn</option><option value="hard-light">hard-light</option><option value="soft-light">soft-light</option></select></div>
<div class="visdiff-buttons"><button id="vdhide" class="visdiff-btn">Hide</button><button id="vdtoggleui" class="visdiff-btn">Toggle UI</button><button id="vdreset" class="visdiff-btn">Reset</button><button id="vdclose" class="visdiff-btn danger">Close</button></div>
<div class="visdiff-row" style="font-size:12px;color:#a7acc6">Arrows: move | +/-: scale | D: difference | H: hide UI | Esc: close</div>`;root.appendChild(panel);d.documentElement.appendChild(root);let open=false,showUI=true;const fileInput=panel.querySelector('#vdupload');const opInput=panel.querySelector('#vdopacity');const opVal=panel.querySelector('#vdopval');const scInput=panel.querySelector('#vdscale');const scVal=panel.querySelector('#vdscval');const xInput=panel.querySelector('#vdx');const yInput=panel.querySelector('#vdy');const blendSel=panel.querySelector('#vdblend');const btnHide=panel.querySelector('#vdhide');const btnToggleUI=panel.querySelector('#vdtoggleui');const btnReset=panel.querySelector('#vdreset');const btnClose=panel.querySelector('#vdclose');let posX=0,posY=0,scale=1,opacity=0.6,blend='normal';function apply(){float.style.left=posX+'px';float.style.top=posY+'px';float.style.transform=`scale(${scale})`;img.style.opacity=opacity;img.style.mixBlendMode=blend;xInput.value=String(Math.round(posX));yInput.value=String(Math.round(posY));scVal.textContent=Math.round(scale*100)+'%';opVal.textContent=Math.round(opacity*100)+'%'}function reset(){posX=0;posY=0;scale=1;opacity=0.6;blend='normal';apply()}function openUI(){open=true;root.classList.remove('visdiff-hidden');panel.classList.toggle('visdiff-hidden',!showUI)}function closeUI(){open=false;root.classList.add('visdiff-hidden');panel.classList.add('visdiff-hidden')}function toggleUI(){showUI=!showUI;panel.classList.toggle('visdiff-hidden',!showUI)}fileInput.addEventListener('change',e=>{const f=e.target.files&&e.target.files[0];if(!f)return;const url=URL.createObjectURL(f);img.onload=()=>{URL.revokeObjectURL(url)};img.src=url;});opInput.addEventListener('input',()=>{opacity=(parseInt(opInput.value,10)||0)/100;apply()});scInput.addEventListener('input',()=>{scale=(parseInt(scInput.value,10)||100)/100;apply()});xInput.addEventListener('change',()=>{posX=parseFloat(xInput.value)||0;apply()});yInput.addEventListener('change',()=>{posY=parseFloat(yInput.value)||0;apply()});blendSel.addEventListener('change',()=>{blend=blendSel.value;apply()});btnHide.addEventListener('click',()=>{float.classList.toggle('visdiff-hidden')});btnToggleUI.addEventListener('click',toggleUI);btnReset.addEventListener('click',reset);btnClose.addEventListener('click',closeUI);let drag=false,ox=0,oy=0;float.addEventListener('mousedown',e=>{drag=true;ox=e.clientX-posX;oy=e.clientY-posY;e.preventDefault()},{passive:false});d.addEventListener('mousemove',e=>{if(!drag)return;posX=e.clientX-ox;posY=e.clientY-oy;apply()});d.addEventListener('mouseup',()=>{drag=false});d.addEventListener('keydown',e=>{if(!open)return;const step=e.shiftKey?10:1;if(e.key==='Escape'){closeUI()}else if(e.key==='ArrowLeft'){posX-=step;apply()}else if(e.key==='ArrowRight'){posX+=step;apply()}else if(e.key==='ArrowUp'){posY-=step;apply()}else if(e.key==='ArrowDown'){posY+=step;apply()}else if(e.key==='+'||e.key==='='){scale*=e.shiftKey?1.05:1.01;scInput.value=String(Math.round(scale*100));apply()}else if(e.key==='-'||e.key==='_'){scale/=e.shiftKey?1.05:1.01;scInput.value=String(Math.round(scale*100));apply()}else if(e.key==='d'||e.key==='D'){blend=(blend==='difference'?'normal':'difference');blendSel.value=blend;apply()}else if(e.key==='h'||e.key==='H'){toggleUI()}});apply();openUI();window.__VIS_DIFF__={open:openUI,close:closeUI,toggle:toggleUI}})();